
<html>
<script style="text\javascript">

    $(document).ready(showindi());
    var unusedarray=new Array();
    var usedarray=new Array();
    var allarray=new Array();
    var usedtotal;
    var a,u,n;
    $('#first').hide();
    function showindi(){
        $.get("http://localhost:8090/dhis/api/indicators.json", function(data){
            $('#indicators').html("");
            var total=(data.indicators.length);
            $(data.indicators).each(function(i,indi){
            
                var indicator=$("<a></a>").append(indi.name).append('</br>');
                allarray.push(indi.id);
                $('#indicators').append(indicator);               
            });
            $('#total').append(allarray.length);
            showopts(); 
            
            
        });
    
    }
   function showopts(){
   
      $("button").click(function(){
      //clear the used once you start searching for indicators
     
        //go to the maps url in json
        $.get("http://localhost:8090/dhis/api/mapViews.json",function(mapsdata){
         $('#used').html("");
               alert("currently searching maps");
               //go to each mapview object
               $(mapsdata.mapViews).each(function(i,view){
               //go to each href of each mapview object looking for the concerned indicators
                    $.get(view.href+'.json',function(individualmap){
                    // alert("got a map!!! yipeeee!!!!");
                        //if found, go to each indicator
                        $(individualmap.indicator).each(function(i,indim){
                        $('#usedtotal').html("");
                            var value=(indim.id);
                            var n=-1;
                           if ((usedarray.indexOf(indim.id))==n)
                            {
                                usedarray.push(indim.id);
                                var used=$("<a></a>").attr('href',individualmap.href+'/data').append(indim.name).append('</br>');
                                $('#used').append(used);
                                }  
                        });
                       // var usedtotal=(usedarray.length);
                        //$('#usedtotal').append(usedtotal);
                    });
               });
            
            
        });
        
        $.get("http://localhost:8090/dhis/api/charts.json",function(chartsdata){
            
               alert("currently searching charts");
               
               $(chartsdata.charts).each(function(i,cview){
              
                    $.get(cview.href+'.json',function(individualchart){
                    
                        
                        $(individualchart.indicators).each(function(i,indic){
                       $('#usedtotal').html("");
                            var value=(indic.id);
                            //alert(indic.id);
                            var n=-1;
                          if ((usedarray.indexOf(indic.id))==n)
                           {
                                 usedarray.push(indic.id);
                                 var used=$("<a></a>").attr('href',individualchart.href+'/data').append(indic.name).append('</br>');
                                 $('#used').append(used);
                               }
                            
                            
                          //  var usedtotal=(usedarray.length);
                            $('#usedtotal').append(usedarray.length);
                            
                        });
                     
                      
                    });
                  
                    
               });
            
            
             
             
            
        });
        
        $.get("http://localhost:8090/dhis/api/reportTables.json",function(rtsdata){
            
               alert("currently searching report tables");
               
               $(rtsdata.reportTables).each(function(i,rtview){
              
                    $.get(rtview.href+'.json',function(individualtable){
                    
                        
                        $(individualtable.indicators).each(function(i,indirt){
                            $('#usedtotal').html("");
                            var value=(indirt.id);
                            var n=-1;
                                if ((usedarray.indexOf(indirt.id))==n)
                                {
                                     usedarray.push(indirt.id);
                                     //$('#usedtotal').append(usedarray.length);
                                     var used=$("<a></a>").attr('href',individualtable.href+'/data').append(indirt.name).append('</br>');
                                     $('#used').append(used);
                                     
                                }
                                else{
                               // $('#usedtotal').append(usedarray.length); 
                                };
                                
                        });
                    });
               });
             diff(usedarray);
            
             
             
            
        });
        //get indicators
     function diff(usedarray){
        alert(usedarray);
        
       $.get("http://localhost:8090/dhis/api/indicators.json", function(data){
            $(data.indicators).each(function(i,indi){
               // alert(indi.data);
               // $('#unusedcount').html("");
                var n=-1;
                if ((usedarray.indexOf(indi.id))==n){
                    
                    unusedarray.push(indi.name);
                    $('#unused').append(indi.name).append('</br>');
                   // $('#unusedcount').append(unusedarray.length);
                    
                }
                           
            });
            $('#unusedcount').append(unusedarray.length);
            a=(data.indicators.length); alert(a);
            u=(usedarray.length); alert(u);
            n=(unusedarray.length); alert(n);
            percentage(a,u,n);
        }); 
        
        
    }
   });
   
}   
    
    function percentage(a,u,n){
        pu=(u/a)*100;
        alert(pu);
        $('#usedpercent').append(pu);
        
      /*  pn=(n/p)*100;
        alert(pn);
        $('#unusedpercent').append(pn);*/
        
    }
</script>
<div>
<div style="width:33%">
<label>Indicators</label>
<div id="indicators"></div>
<label>Total</label>
<div id="total"></div>
</div>
<div  style="width:40% float:right position:absolute;">
<button>Maps</button>
</div>
<table>
<td>
<div>
<label>Used</label>
<div id="used"></div>
<label>Total Used</label>
<div id="usedtotal"></div>
<div id="usedpercent"></div>
</div>
</td>
<td>
<label>Unused</label>
<div id="unused"></div>
<label>Total Unused</label>
<div id="unusedcount"></div>
<div id="unusedpercent"></div>
</td>
</table>
</div>
</div>
</div>
</html>